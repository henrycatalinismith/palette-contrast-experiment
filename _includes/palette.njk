<!doctype html>
<html
  lang="en"
  dir="ltr">
  <head>
    <meta charset="utf-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />

    <style>
    	{{ css | safe }}
    </style>

    <title>
      {{ title }}
    </title>
  </head>
  <body>
    <main>
      <h1>
        {{ name }}
      </h1>

      <p>
        {{ description }}
      </p>


      {% set offset = 25 %}
      <svg class="summary" viewBox="0 0 48 48" width="128" height="128">
        <circle r="15.915" cx="24" cy="24" fill="white" />
        {% for label, count in summary.scores %}
          {% set p = count / summary.total * 100 %}
          <circle
            class="summary-{{ label | replace(" ", "") | slug }}"
            r="15.915"
            cx="24"
            cy="24"
            stroke-dasharray="{{ p }} {{ 100 - p }}"
            stroke-dashoffset="{{ offset }}"
          />
          {% set offset = offset + (100 - p) %}
        {% endfor %}
      </svg>

      <table>
        <thead>
          <tr>
            <th>Rating</th>
            <th>Color combinations</th>
          </tr>
        </thead>
        <tbody>
          {% for label, count in summary.scores %}
            <tr>
              <td>{{ label }}</td>
              <td>{{ count / 2 }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <ol class="palette">
        {% set i = 0 %}
        {% for color in colors %}
          <li class="palette-item" data-i="{{ i }}">
            <input
              class="palette-button"
              type="radio"
              id="{{ color.label }}"
              name="color"
              value="{{ color.label }}"
              style="background-color: {{ color.value }}"
              {% if i == 0 %}checked{% endif %}
            />
            <span class="palette-label">
              {{ color.label }}
            </span>
          </dt>
          {% set i = i + 1 %}
        {% endfor %}
      </ol>

      <table class="pairs">
        <tbody>
          {% for pair in pairs %}
            <tr data-bg="{{ pair.bg.label }}">
              <td
                class="pair-sample"
                style="background-color: {{ pair.bg.value }}; color: {{ pair.fg.value }}">
                <span>
                {{ pair.fg.label }}
                on
                {{ pair.bg.label }}
                </span>
              </td>
              <td>
                {{ pair.label }}
              </td>
              <td>
                {{ pair.ratio }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </ol>

    </main>

    <script>
      const styleFilter = document.createElement("style")
      document.body.appendChild(styleFilter)
      function filter(label) {
        styleFilter.innerHTML = `
          .pairs tr[data-bg="${label}"] {
            display: block;
          }

          .pairs tr:not([data-bg="${label}"]) {
            display: none;
          }
        `
      }

      document.addEventListener("DOMContentLoaded", () => {
        filter(document.querySelector(".palette-button:checked").value)
        document
          .querySelectorAll(".palette-button")
          .forEach(button => button.addEventListener("change", function() {
            filter(this.value)
          }))
      })
    </script>
  </body>
</html>

