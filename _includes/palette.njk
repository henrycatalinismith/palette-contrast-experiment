<!doctype html>
<html
  lang="en"
  dir="ltr">
  <head>
    <meta charset="utf-8" />

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />

    <link
      rel="stylesheet"
      href="style.scss"
    />
    <style>

      {% set i = 0 %}
      {% for color in colors %}
        :root {
          --display-{{ color.label }}: {% if i == 0 %}grid{% else %}none{% endif %};
        }

        tr[data-bg="{{ color.label }}"] {
          display: var(--display-{{color.label}});
        }
        {% set i = i + 1 %}
      {% endfor %}
    </style>

    <title>
      {{ title }}
    </title>
  </head>
  <body>
    <main>
      <header class="palette-header">
        <h1>
          {{ name }}
        </h1>

        <p>
          {{ description }}
        </p>
      </header>

      <section class="palette-score">
        {% set offset = 25 %}
        <svg class="summary" viewBox="4 4 40 40">
          <circle r="15.915" cx="24" cy="24" fill="white" />
          {% for label, count in summary.scores %}
            {% set p = count / summary.total * 100 %}
            <circle
              class="summary-{{ label | replace(" ", "") | slug }}"
              r="15.915"
              cx="24"
              cy="24"
              stroke-dasharray="{{ p }} {{ 100 - p }}"
              stroke-dashoffset="{{ offset }}"
            />
            {% set offset = offset + (100 - p) %}
          {% endfor %}
        </svg>

        <table class="palette-scores">
          <thead>
            <tr>
              <th>Rating</th>
              <th>Pairs</th>
            </tr>
          </thead>
          <tbody>
            {% for label, count in summary.scores %}
              <tr>
                <td class="palette-score-label" data-rating="{{ label }}">
                  {{ label }}
                </td>
                <td>{{ count / 2 }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

      </section>

      <ol class="palette">
        {% set i = 0 %}
        {% for color in colors %}
          <li class="palette-item" data-i="{{ i }}">
            <input
              class="palette-button"
              type="radio"
              id="{{ color.label }}"
              name="color"
              value="{{ color.label }}"
              style="background-color: {{ color.value }}"
              {% if i == 0 %}checked{% endif %}
              aria-label="{{ color.label }}"
            />
          </dt>
          {% set i = i + 1 %}
        {% endfor %}
      </ol>

      <table class="pairs">
        <tbody>
          {% for pair in pairs %}
            <tr data-bg="{{ pair.bg.label }}" class="pair">
              <td
                class="pair-sample"
                style="background-color: {{ pair.bg.value }}; color: {{ pair.fg.value }}">
                ABC
              </td>
              <td class="pair-label">
                {{ pair.fg.label }}
                ({{ pair.ratio }})
              </td>
              <td class="pair-rating" data-rating="{{ pair.label }}">
                {{ pair.label }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

    </main>


    <script id="colors" type="application/json">
      {{ colors | dump | safe }}
    </script>

    <script>
      const colors = JSON.parse(
        document.querySelector("#colors").innerText
      )

      function filter(label) {
        colors.forEach(color => {
          document.documentElement.style.setProperty(
            `--display-${color.label}`,
            "none",
          )
        })

        document.documentElement.style.setProperty(
          `--display-${label}`,
          "grid"
        )
      }

      document.addEventListener("DOMContentLoaded", () => {
        document
          .querySelectorAll(".palette-button")
          .forEach(button => button.addEventListener("change", function() {
            filter(this.value)
          }))
      })
    </script>
  </body>
</html>

